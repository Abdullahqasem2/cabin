flowchart LR

  %% ===== Client Side =====
  subgraph CLIENT["Client Apps"]
    C1["Customer App\nReact Native"]
    C2["Staff App\nReact Native"]
    C3["Admin Dashboard\nReact/Next.js - Vercel"]
  end

  %% ===== Backend & Infra (Contabo) =====
    subgraph CONTABO["Contabo VPS"]
    API["Node.js / Express API"]
    DB[(MongoDB)]
    MQ["MQTT / WebSocket Broker"]
    AUTH["Auth Service\n(JWT / Tokens)"]
  end

  %% ===== Smart Cabin (per bed/capsule) =====
  subgraph CABIN["Smart Cabin (Per Capsule)"]
    RPI["Raspberry Pi"]

    subgraph SENSORS["Sensors"]
      CAM["Face Recognition\nCamera (Eyes Open/Close)"]
      GEST["Hand Gesture\nSensor/Camera"]
    end

    subgraph ACT["Actuators"]
      LIGHT["Smart Light\n(On/Off + Dimmer)"]
      AC["AC Controller\n(Temperature Level)"]
      LOCK["Smart Locks\nMain Door / Room / Cabin"]
    end
  end

  %% ===== External Services =====
  PGW["Payment Gateway"]
  NOTI["Push Notifications\nFCM / Expo"]

  %% ===== Flows =====

  %% Mobile & Admin -> Backend
  C1 -->|HTTPS / REST + WebSocket| API

  C2 -->|HTTPS / REST + WebSocket| API

  C3 -->|HTTPS - Dashboard API| API

  %% Backend internal
  API --> AUTH

  API --> DB

  API <---> MQ

  %% Payment & Notifications
  API --> PGW

  API --> NOTI

  %% Backend <-> Raspberry Pi
  RPI <-->|"MQTT / WebSocket\n(Commands & Events)"| MQ

  %% Sensors -> Raspberry Pi
  CAM --> RPI

  GEST --> RPI

  %% Raspberry Pi -> Actuators
  RPI --> LIGHT

  RPI --> AC

  RPI --> LOCK